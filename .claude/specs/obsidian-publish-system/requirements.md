# Obsidian 发布系统 v0.1 需求文档

## 简介

本项目旨在构建一个完整的 Obsidian 笔记发布系统，包括客户端插件和服务端实现。用户可以通过 Obsidian 插件将 Markdown 笔记发布到自定义域名 `https://share.141029.xyz`，实现笔记的在线分享和管理。

## 功能需求

### 1. 客户端 Base URL 配置

**用户故事**: 作为一个 Obsidian 用户，我希望插件能连接到自定义的发布服务，以便我可以使用自己的域名发布笔记。

**验收标准**:
1.1. 系统应该将 base URL 从 `https://obsius.site` 修改为 `https://share.141029.xyz`
1.2. 系统应该保持与现有插件 API 的完全兼容性
1.3. 系统应该在修改 URL 后能正常执行所有发布操作

### 2. 文章创建功能

**用户故事**: 作为一个 Obsidian 用户，我希望能够发布我的 Markdown 笔记到网上，以便我可以分享给其他人。

**验收标准**:
2.1. 系统应该提供 POST / API 端点来创建新文章
2.2. 系统应该接受标题和 Markdown 内容作为输入参数
2.3. 系统应该返回唯一的文章 ID 和私有 secret
2.4. 系统应该生成8位短 ID 格式的文章标识符
2.5. 系统应该将文章数据存储在 SQLite 数据库中
2.6. 系统应该返回可访问的 URL 格式为 `https://share.141029.xyz/{id}`

### 3. 文章更新功能

**用户故事**: 作为一个 Obsidian 用户，我希望能够更新已发布的文章，以便我可以修正错误或添加新内容。

**验收标准**:
3.1. 系统应该提供 PUT /{id} API 端点来更新现有文章
3.2. 系统应该验证提供的 secret 与文章的 secret 匹配
3.3. 系统应该允许更新文章的标题和内容
3.4. 系统应该更新文章的 updated_at 时间戳
3.5. 系统应该在 secret 验证失败时返回 401 错误

### 4. 文章删除功能

**用户故事**: 作为一个 Obsidian 用户，我希望能够删除已发布的文章，以便我可以移除不需要的内容。

**验收标准**:
4.1. 系统应该提供 DELETE /{id} API 端点来删除文章
4.2. 系统应该验证提供的 secret 与文章的 secret 匹配
4.3. 系统应该从数据库中永久删除文章记录
4.4. 系统应该在 secret 验证失败时返回 401 错误
4.5. 系统应该在文章不存在时返回 404 错误

### 5. 文章访问功能

**用户故事**: 作为一个访问者，我希望能够通过 URL 访问发布的文章，以便我可以阅读分享的内容。

**验收标准**:
5.1. 系统应该提供 GET /{id} 端点来访问发布的文章
5.2. 系统应该将 Markdown 内容渲染为 HTML 格式
5.3. 系统应该在文章不存在时返回 404 错误
5.4. 系统应该提供基本的 HTML 页面结构和样式
5.5. 系统应该支持 Markdown 的基本语法渲染

### 6. 项目结构重组

**用户故事**: 作为一个开发者，我希望项目采用 Monorepo 结构，以便我可以更好地管理客户端和服务端代码。

**验收标准**:
6.1. 系统应该创建 client/ 目录存放 Obsidian 插件源码
6.2. 系统应该创建 server/ 目录存放 Express 服务端代码
6.3. 系统应该创建 shared/ 目录存放共享类型定义
6.4. 系统应该保持 Obsidian 插件的构建输出在根目录
6.5. 系统应该确保构建后的插件能正常在 Obsidian 中加载

### 7. 服务端基础架构

**用户故事**: 作为一个系统管理员，我希望服务端能够稳定运行并处理 API 请求，以便用户可以可靠地使用发布功能。

**验收标准**:
7.1. 系统应该使用 Express.js 框架构建 REST API
7.2. 系统应该使用 SQLite 数据库存储文章数据
7.3. 系统应该使用 Docker 容器化部署在 VPS 服务器上
7.4. 系统应该配置自定义域名 `https://share.141029.xyz`
7.5. 系统应该包含基本的错误处理和日志记录
7.6. 系统应该包含 CORS 配置以支持跨域请求
7.7. 系统应该使用 Nginx 作为反向代理和 SSL 终止
7.8. 系统应该使用 Docker Compose 编排多服务容器
7.9. 系统应该使用 Let's Encrypt 自动管理 SSL 证书

## 非功能需求

### 8. 性能要求

**用户故事**: 作为一个用户，我希望系统响应迅速，以便我可以高效地发布和访问文章。

**验收标准**:
8.1. 系统应该在 95% 的情况下 API 响应时间小于 500ms
8.2. 系统应该支持并发访问而不出现明显的性能下降
8.3. 系统应该优化数据库查询以提高响应速度

### 9. 安全要求

**用户故事**: 作为一个用户，我希望我的文章数据是安全的，以便我可以放心地使用这个服务。

**验收标准**:
9.1. 系统应该使用随机生成的 secret 来保护文章修改操作
9.2. 系统应该验证所有输入参数以防止注入攻击
9.3. 系统应该使用 HTTPS 协议保护数据传输
9.4. 系统应该限制文章 ID 的可枚举性

### 10. 可靠性要求

**用户故事**: 作为一个用户，我希望服务能够稳定运行，以便我可以随时访问我发布的内容。

**验收标准**:
10.1. 系统应该具备基本的错误处理机制
10.2. 系统应该在容器异常退出时自动重启服务
10.3. 系统应该包含足够的日志记录以便问题诊断
10.4. 系统应该在数据库文件损坏时能够优雅处理错误
10.5. 系统应该实现数据持久化，确保容器重启后数据不丢失
10.6. 系统应该包含健康检查机制监控服务状态

### 11. 部署和运维需求

**用户故事**: 作为一个系统管理员，我希望能够轻松部署和维护系统，以便确保服务的持续可用性。

**验收标准**:
11.1. 系统应该提供 Dockerfile 用于构建应用容器镜像
11.2. 系统应该提供 docker-compose.yml 文件编排所有服务
11.3. 系统应该提供自动化部署脚本简化部署流程
11.4. 系统应该包含 Nginx 配置文件用于反向代理设置
11.5. 系统应该提供数据备份和恢复机制
11.6. 系统应该包含基础监控和日志收集配置
11.7. 系统应该提供防火墙和安全加固配置指南