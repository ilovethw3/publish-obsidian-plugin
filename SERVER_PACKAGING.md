# Serverç«¯æ‰“åŒ…éƒ¨ç½²è¯´æ˜

æœ¬æ–‡æ¡£è¯´æ˜å¦‚ä½•ä½¿ç”¨serverç«¯æ‰“åŒ…å·¥å…·ï¼Œåˆ›å»ºå¯ç‹¬ç«‹éƒ¨ç½²çš„ZIPåŒ…ã€‚

## æ¦‚è¿°

Serverç«¯æ‰“åŒ…ç³»ç»ŸåŒ…å«ä»¥ä¸‹ç»„ä»¶ï¼š

- **`build-server-package.sh`** - æ ¸å¿ƒæ‰“åŒ…è„šæœ¬
- **`release-server.sh`** - ç‰ˆæœ¬ç®¡ç†å’Œå‘å¸ƒå·¥å…·
- **`.github/workflows/build-server-package.yml`** - GitHub Actionsè‡ªåŠ¨æ„å»º

## å¿«é€Ÿä½¿ç”¨

### æ„å»ºæœ€æ–°ç‰ˆæœ¬åŒ…
```bash
./release-server.sh
# æˆ–
./release-server.sh latest
```

### æ„å»ºç‰¹å®šç‰ˆæœ¬åŒ…
```bash
./release-server.sh v1.0.0
./release-server.sh v1.2.3-beta
```

### æŸ¥çœ‹å·²æ„å»ºçš„åŒ…
```bash
./release-server.sh list
```

### æ¸…ç†æ„å»ºç›®å½•
```bash
./release-server.sh clean
```

## åŒ…ç»“æ„

ç”Ÿæˆçš„ZIPåŒ…åŒ…å«ä»¥ä¸‹æ–‡ä»¶ï¼š

```
obsidian-publisher-server/
â”œâ”€â”€ deploy.sh                    # ä¼˜åŒ–çš„éƒ¨ç½²è„šæœ¬
â”œâ”€â”€ .env.example                 # ç¯å¢ƒå˜é‡æ¨¡æ¿
â”œâ”€â”€ INSTALL.md                   # è¯¦ç»†å®‰è£…è¯´æ˜
â”œâ”€â”€ README.md                    # é¡¹ç›®è¯´æ˜
â”œâ”€â”€ DEPLOYMENT.md                # éƒ¨ç½²æ–‡æ¡£
â”œâ”€â”€ docker-compose.yml           # Dockeré…ç½®
â”œâ”€â”€ server/
â”‚   â”œâ”€â”€ nginx/                   # Nginxé…ç½®æ–‡ä»¶
â”‚   â”‚   â””â”€â”€ nginx-cloudflare.conf
â”‚   â”œâ”€â”€ database/               # æ•°æ®åº“ç›®å½•(ç©º)
â”‚   â””â”€â”€ logs/                   # æ—¥å¿—ç›®å½•(ç©º)
â””â”€â”€ shared/
    â””â”€â”€ types.ts                # å…±äº«ç±»å‹å®šä¹‰
```

## ç”¨æˆ·ä½¿ç”¨æµç¨‹

ç”¨æˆ·æ”¶åˆ°ZIPåŒ…åçš„ä½¿ç”¨æµç¨‹ï¼š

1. **è§£å‹åŒ…**ï¼š
   ```bash
   unzip obsidian-publisher-server-v1.0.0.zip
   cd obsidian-publisher-server
   ```

2. **é…ç½®ç¯å¢ƒ**ï¼š
   ```bash
   cp .env.example .env
   nano .env  # ç¼–è¾‘é…ç½®
   ```

3. **éƒ¨ç½²æœåŠ¡**ï¼š
   ```bash
   ./deploy.sh deploy-prod
   ```

4. **éªŒè¯éƒ¨ç½²**ï¼š
   ```bash
   ./deploy.sh status
   curl http://localhost/health
   ```

## ä¼˜åŒ–çš„deploy.shç‰¹æ€§

æ‰“åŒ…ç‰ˆæœ¬çš„deploy.shç›¸æ¯”åŸç‰ˆæœ‰ä»¥ä¸‹æ”¹è¿›ï¼š

### ğŸ” æ™ºèƒ½ç¯å¢ƒæ£€æŸ¥
- è‡ªåŠ¨æ£€æŸ¥Dockerå’ŒDocker Composeå¯ç”¨æ€§
- éªŒè¯.envæ–‡ä»¶å­˜åœ¨æ€§å’Œå®Œæ•´æ€§
- æ£€æŸ¥API_TOKENé•¿åº¦å’Œæ ¼å¼
- å‹å¥½çš„é”™è¯¯æç¤ºå’Œè§£å†³å»ºè®®

### ğŸ“¦ ç¦»çº¿éƒ¨ç½²æ”¯æŒ
- ç§»é™¤gitä¾èµ–ï¼Œæ”¯æŒç¦»çº¿ç¯å¢ƒ
- è‡ªåŠ¨å¤„ç†Dockeré•œåƒæ‹‰å–å¤±è´¥æƒ…å†µ
- æ”¯æŒä»æœ¬åœ°æ„å»ºæˆ–é¢„æ„å»ºé•œåƒéƒ¨ç½²

### ğŸ›  å¢å¼ºçš„é”™è¯¯å¤„ç†
- è¯¦ç»†çš„é”™è¯¯æ—¥å¿—å’Œè°ƒè¯•ä¿¡æ¯
- è‡ªåŠ¨æƒé™ä¿®å¤å»ºè®®
- å®Œæ•´çš„æ•…éšœæ’é™¤æŒ‡å—

### ğŸ“Š æ”¹è¿›çš„çŠ¶æ€æ˜¾ç¤º
- æ›´æ¸…æ™°çš„å®¹å™¨çŠ¶æ€å±•ç¤º
- å¥åº·æ£€æŸ¥ç»“æœæ˜¾ç¤º
- æœ‰ç”¨çš„ç®¡ç†å‘½ä»¤æç¤º

## GitHub Actionsé›†æˆ

é¡¹ç›®åŒ…å«GitHub Actionså·¥ä½œæµï¼Œå¯ä»¥ï¼š

### è‡ªåŠ¨è§¦å‘æ¡ä»¶
- æ¨é€ç‰ˆæœ¬æ ‡ç­¾æ—¶è‡ªåŠ¨æ„å»º (ä¾‹å¦‚ï¼š`git push origin v1.0.0`)
- æ‰‹åŠ¨è§¦å‘æ„å»º
- æ”¯æŒè‡ªå®šä¹‰ç‰ˆæœ¬å·

### è‡ªåŠ¨åŒ–åŠŸèƒ½
- æ„å»ºserveråŒ…
- ç”Ÿæˆæ ¡éªŒå’Œ(SHA256, MD5)
- åˆ›å»ºå‘å¸ƒè¯´æ˜
- ä¸Šä¼ åˆ°GitHub Releases
- æ„å»ºæ‘˜è¦æŠ¥å‘Š

### ä½¿ç”¨æ–¹æ³•
```bash
# åˆ›å»ºç‰ˆæœ¬æ ‡ç­¾å¹¶æ¨é€
git tag v1.0.0
git push origin v1.0.0

# GitHub Actionsä¼šè‡ªåŠ¨ï¼š
# 1. æ„å»ºåŒ…
# 2. åˆ›å»ºRelease
# 3. ä¸Šä¼ æ–‡ä»¶å’Œæ ¡éªŒå’Œ
```

## é«˜çº§åŠŸèƒ½

### ç‰ˆæœ¬ç®¡ç†
- æ”¯æŒè¯­ä¹‰åŒ–ç‰ˆæœ¬å· (v1.0.0)
- æ”¯æŒé¢„å‘å¸ƒç‰ˆæœ¬ (v1.0.0-beta)
- è‡ªåŠ¨ç”Ÿæˆæ ¡éªŒå’Œæ–‡ä»¶
- ç»´æŠ¤latestç¬¦å·é“¾æ¥

### åŒ…ä¼˜åŒ–
- æ’é™¤ä¸å¿…è¦æ–‡ä»¶(.git, node_modulesç­‰)
- å‹ç¼©å¤§å°çº¦33KB
- åŒ…å«æ‰€æœ‰å¿…éœ€çš„é…ç½®å’Œæ–‡æ¡£

### éƒ¨ç½²è„šæœ¬åŠŸèƒ½
å®Œæ•´çš„éƒ¨ç½²å‘½ä»¤æ”¯æŒï¼š
```bash
./deploy.sh deploy        # é»˜è®¤éƒ¨ç½²
./deploy.sh deploy-prod   # ç”Ÿäº§éƒ¨ç½²
./deploy.sh deploy-dev    # å¼€å‘éƒ¨ç½²
./deploy.sh status        # çŠ¶æ€æ£€æŸ¥
./deploy.sh logs          # æŸ¥çœ‹æ—¥å¿—
./deploy.sh restart       # é‡å¯æœåŠ¡
./deploy.sh stop          # åœæ­¢æœåŠ¡
./deploy.sh backup        # åˆ›å»ºå¤‡ä»½
./deploy.sh help          # å¸®åŠ©ä¿¡æ¯
```

## æœ€ä½³å®è·µ

### å‘å¸ƒæµç¨‹
1. æµ‹è¯•æœ¬åœ°æ„å»ºï¼š`./release-server.sh v1.0.0`
2. æµ‹è¯•åŒ…éƒ¨ç½²ï¼šè§£å‹å¹¶éƒ¨ç½²æµ‹è¯•
3. åˆ›å»ºgitæ ‡ç­¾ï¼š`git tag v1.0.0`
4. æ¨é€æ ‡ç­¾ï¼š`git push origin v1.0.0`
5. GitHub Actionsè‡ªåŠ¨å¤„ç†åç»­å‘å¸ƒ

### ç‰ˆæœ¬å·çº¦å®š
- ä¸»ç‰ˆæœ¬ï¼š`v1.0.0`, `v2.0.0`
- æ¬¡ç‰ˆæœ¬ï¼š`v1.1.0`, `v1.2.0`
- è¡¥ä¸ç‰ˆæœ¬ï¼š`v1.0.1`, `v1.0.2`
- é¢„å‘å¸ƒï¼š`v1.0.0-alpha`, `v1.0.0-beta`, `v1.0.0-rc1`

### æµ‹è¯•å»ºè®®
1. åœ¨å¹²å‡€çš„Linuxç¯å¢ƒæµ‹è¯•éƒ¨ç½²
2. éªŒè¯æ‰€æœ‰é…ç½®é€‰é¡¹
3. æµ‹è¯•ä¸åŒçš„nginxé…ç½®æ–‡ä»¶
4. éªŒè¯å¥åº·æ£€æŸ¥å’ŒAPIåŠŸèƒ½

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

**æ„å»ºå¤±è´¥**ï¼š
- æ£€æŸ¥build-server-package.shæƒé™
- ç¡®ä¿åœ¨é¡¹ç›®æ ¹ç›®å½•è¿è¡Œ
- éªŒè¯zip/unzipå·¥å…·å·²å®‰è£…

**GitHub Actionså¤±è´¥**ï¼š
- æ£€æŸ¥ç‰ˆæœ¬æ ‡ç­¾æ ¼å¼
- ç¡®ä¿GITHUB_TOKENæƒé™å……è¶³
- æŸ¥çœ‹Actionsæ—¥å¿—è¯¦ç»†é”™è¯¯

**éƒ¨ç½²å¤±è´¥**ï¼š
- æ£€æŸ¥.envæ–‡ä»¶é…ç½®
- éªŒè¯Dockeræƒé™
- æŸ¥çœ‹deploy.shæ—¥å¿—è¾“å‡º

### è·å–å¸®åŠ©
- æŸ¥çœ‹INSTALL.mdè¯¦ç»†è¯´æ˜
- ä½¿ç”¨`./deploy.sh help`æŸ¥çœ‹å‘½ä»¤
- æ£€æŸ¥æ„å»ºæ—¥å¿—å’Œé”™è¯¯ä¿¡æ¯

## æ€»ç»“

Serverç«¯æ‰“åŒ…ç³»ç»Ÿæä¾›äº†å®Œæ•´çš„è§£å†³æ–¹æ¡ˆï¼Œè®©ç”¨æˆ·èƒ½å¤Ÿï¼š
- å¿«é€Ÿéƒ¨ç½²Obsidianå‘å¸ƒæœåŠ¡
- æ— éœ€äº†è§£å¤æ‚çš„Dockerå’Œnginxé…ç½®
- è·å¾—ç”Ÿäº§å°±ç»ªçš„éƒ¨ç½²åŒ…
- äº«å—è‡ªåŠ¨åŒ–çš„æ„å»ºå’Œå‘å¸ƒæµç¨‹

è¿™å¤§å¤§ç®€åŒ–äº†serverç«¯çš„åˆ†å‘å’Œéƒ¨ç½²è¿‡ç¨‹ã€‚